"use strict";function setScrollAtCenter(e,t){let n=getComputedStyle(t),r=parseInt(n.getPropertyValue("--work-space-width")),a=parseInt(n.getPropertyValue("--work-space-height")),i=e.clientWidth,o=e.clientHeight;e.scrollTo(r/2-i/2,a/2-o/2)}let gridSnap=10;function getPosOnGrid(e){return{x:Math.round(e.x/gridSnap)*gridSnap,y:Math.round(e.y/gridSnap)*gridSnap}}function setElementPosition(e,t){e.style.transform=`translate(${t.x}px, ${t.y}px)`}function getPositionInWorkspaceByEvent(e,t){var n=e.getBoundingClientRect();return{x:t.clientX-n.left,y:t.clientY-n.top}}function GetTranslateXY(e){const t=window.getComputedStyle(e),n=new DOMMatrixReadOnly(t.transform);return{x:n.m41,y:n.m42}}function startDragMove(e,t,n,r){e.preventDefault();let a={x:e.clientX,y:e.clientY},i=GetTranslateXY(t);document.onmouseup=function(){document.onmouseup=null,document.onmousemove=null,r(t,i)},document.onmousemove=function(e){e.preventDefault();const r=a.x-e.clientX,o=a.y-e.clientY;a.x=e.clientX,a.y=e.clientY,i.x=i.x-r,i.y=i.y-o,n(t,i)}}function startDragScroll(e,t){t.style.cursor="grabbing",t.style.userSelect="none";let n=t.scrollLeft,r=t.scrollTop,a=e.clientX,i=e.clientY;document.onmouseup=function(){t.style.cursor="grab",t.style.removeProperty("user-select"),document.onmouseup=null,document.onmousemove=null},document.onmousemove=function(e){const o=e.clientX-a,l=e.clientY-i;t.scrollTop=r-l,t.scrollLeft=n-o}}let prevDiagramElem,dragDiagramType="";function makeWorkSpace(e){e.onmousedown=function(e){let n=e.target;if("draggable-header"===n.getAttribute("class")){if(null!==n.closest(".diagram")){let t=GetDiagramIdByElement(n.closest(".diagram"));if(isGuest)return void GenerateDetailsPanelById(t);GenerateDetailsPanelById(t),startDragMove(e,n.closest(".draggable"),((e,n)=>{setElementPosition(e,getPosOnGrid(n)),RegenerateDiagramConnectors(t)}),((e,n)=>{let r=GetDiagramById(t),a=getPosOnGrid(n);r.Position.X===a.x&&r.Position.Y===a.y||(r.Position.X=a.x,r.Position.Y=a.y,UpateJsonDocumentViewer(),RegenerateDetailsPanel(),RegenerateDiagramConnectors(t))}))}else startDragMove(e,n.closest(".draggable"),((e,t)=>{setElementPosition(e,getPosOnGrid(t))}),((e,t)=>{}))}else n.closest(".draggable")||(GenerateDetailsPanelById(-1),startDragScroll(e,t))},e.ondrop=function(t){if(""===dragDiagramType)return;t.preventDefault(),void 0!==prevDiagramElem&&(prevDiagramElem.remove(),prevDiagramElem=void 0);AddDiagram(CreateDiagram(dragDiagramType,getPosOnGrid(getPositionInWorkspaceByEvent(e,t)))),dragDiagramType=""},e.ondragover=function(t){if(""===dragDiagramType)return;t.preventDefault(),void 0===prevDiagramElem&&(prevDiagramElem=GenerateDiagram(CreateDiagram(dragDiagramType,{x:0,y:0})),diagramsSvgContainer.appendChild(prevDiagramElem));let n=getPosOnGrid(getPositionInWorkspaceByEvent(e,t));n.x=n.x+5,n.y=n.y+5,setElementPosition(prevDiagramElem,n)},e.ondragleave=function(e){if(""===dragDiagramType)return;e.preventDefault(),void 0!==prevDiagramElem&&(prevDiagramElem.remove(),prevDiagramElem=void 0)};let t=e.closest(".work-space-view");setScrollAtCenter(t,e)}function startDragDiagram(e){dragDiagramType=e.target.id,e.dataTransfer.setDragImage(new Image,0,0)}document.addEventListener("DOMContentLoaded",(function(){let e=document.getElementsByClassName("add-diag");for(let t=0;t<e.length;t++)e[t].setAttribute("draggable","true"),e[t].ondragstart=startDragDiagram;let t=document.getElementsByClassName("work-space");for(let e=0;e<t.length;e++)makeWorkSpace(t[e])}));var tooltipTriggerList=[].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));function ClearDiagramsSvgContainer(){for(;diagramsSvgContainer.firstChild;)diagramsSvgContainer.removeChild(diagramsSvgContainer.lastChild)}tooltipTriggerList.forEach((function(e){new bootstrap.Tooltip(e)}));let workspace=document.getElementsByClassName("work-space")[0];function RegenerateDiagrams(){let e=[];for(var t=0;t<workspaceDocument.Diagrams.length;t++){let n=GenerateDiagram(workspaceDocument.Diagrams[t]);workspaceDocument.Diagrams[t].Element=n,e.push(n)}ClearDiagramsSvgContainer(),e.forEach((e=>diagramsSvgContainer.appendChild(e)))}function RegenerateDiagram(e){let t=GenerateDiagram(workspaceDocument.Diagrams[e]);diagramsSvgContainer.replaceChild(t,workspaceDocument.Diagrams[e].Element),workspaceDocument.Diagrams[e].Element=t}function RegenerateCurrentDiagram(){RegenerateDiagram(currentSelectedDiagramIndex),RegenerateCurrentDiagramConnectors()}function GetDiagramIdByElement(e){for(var t=0;t<workspaceDocument.Diagrams.length;t++)if(workspaceDocument.Diagrams[t].Element==e)return t}function GetDiagramByElement(e){return workspaceDocument.Diagrams[GetDiagramIdByElement(e)]}function GetDiagramById(e){return workspaceDocument.Diagrams[e]}function IgnoreWorkspacePrivateFields(e,t){return"Element"==e?void 0:t}let uniqueSvgDefId=0;function MakeMultiLineText(e,t,n,r,a){const i="http://www.w3.org/2000/svg",o=document.createElementNS(i,"g");let l=document.createElementNS(i,"defs"),s=document.createElementNS(i,"path");const c="path-"+ ++uniqueSvgDefId;let u="";for(var d=0;d<e;d++)u+=`M${r},${a+15*d} H${t} `;s.setAttributeNS(null,"id",c),s.setAttributeNS(null,"d",u),l.appendChild(s);let m=document.createElementNS(i,"text");m.setAttributeNS(null,"font-size",14);let g=document.createElementNS(i,"textPath");return g.setAttributeNS(null,"href",`#${c}`),g.textContent=n,m.appendChild(g),o.appendChild(l),o.appendChild(m),o}function AccessModifierToChar(e){switch(e){case"Public":return"+";case"Private":default:return"-";case"Protected":return"#"}}function CreateDiagram(e,t){switch(e){case"ClassDiagram":return{Type:"ClassDiagram",Name:"NewClass",Comments:[],TemplateArguments:[],Attributes:[],Properties:[{Type:"int",Name:"New Property",AccessModifier:"Public"}],Methods:[{AccessModifier:"Public",ReturnType:"string",Name:"Method 1",Arguments:[{Type:"string",Name:"name"}]}],Position:{X:t.x,Y:t.y},Element:null};case"Comment":return{Type:"Comment",RowCount:5,Content:"...",Position:{X:t.x,Y:t.y},Element:null};case"Group":return{Type:"Group",Width:1e3,Height:500,Name:"Group",Position:{X:t.x,Y:t.y},Element:null}}}function GetGeneratePropertyFunc(e){switch(e){case"ClassDiagram":return GenerateClassDiagramProperty;case"Comment":case"Group":return()=>{}}}function GenerateClassDiagramProperty(e){switch(e){case"Properties":return{Type:"int",Name:"New property",AccessModifier:"Public"};case"Methods":return{AccessModifier:"Public",ReturnType:"string",Name:"Method 1",Arguments:[]};case"Arguments":return{Type:"string",Name:"name"};case"Attributes":return{Name:"Attribute 1",Arguments:[]};case"TemplateArguments":return{Name:"T",Type:"typename"};case"Comments":return"Comment"}}function GenerateDiagram(e){switch(e.Type){case"ClassDiagram":return GenerateClassDiagram(e);case"Comment":return GenerateCommentDiagram(e);case"Group":return GenerateGroupDiagram(e)}}function GenerateGroupDiagram(e){const t=e.Width,n=e.Height,r="http://www.w3.org/2000/svg",a=document.createElementNS(r,"g");a.setAttributeNS(null,"class","draggable diagram"),a.style.transform=`translate(${e.Position.X}px, ${e.Position.Y}px)`;let i=document.createElementNS(r,"rect");i.setAttributeNS(null,"class","draggable-header"),i.setAttributeNS(null,"x",0),i.setAttributeNS(null,"y",0),i.setAttributeNS(null,"width",t),i.setAttributeNS(null,"height",40),i.setAttributeNS(null,"stroke","#000"),i.setAttributeNS(null,"stroke-width",1),i.setAttributeNS(null,"fill","white"),a.appendChild(i);let o=document.createElementNS(r,"text");o.setAttributeNS(null,"x",t/2),o.setAttributeNS(null,"y",25),o.setAttributeNS(null,"text-anchor","middle"),o.setAttributeNS(null,"fill","black"),o.setAttributeNS(null,"font-weight","bold"),o.textContent=e.Name,a.appendChild(o);let l=document.createElementNS(r,"rect");return l.setAttributeNS(null,"x",0),l.setAttributeNS(null,"y",40),l.setAttributeNS(null,"width",t),l.setAttributeNS(null,"height",n),l.setAttributeNS(null,"stroke","#000"),l.setAttributeNS(null,"stroke-width",1),l.setAttributeNS(null,"fill","none"),a.appendChild(l),a}function GenerateClassDiagram(e){const t=180,n="http://www.w3.org/2000/svg",r=document.createElementNS(n,"g");r.setAttributeNS(null,"class","draggable diagram"),r.style.transform=`translate(${e.Position.X}px, ${e.Position.Y}px)`;let a=document.createElementNS(n,"rect");a.setAttributeNS(null,"class","draggable-header"),a.setAttributeNS(null,"x",0),a.setAttributeNS(null,"y",0),a.setAttributeNS(null,"width",t),a.setAttributeNS(null,"height",40),a.setAttributeNS(null,"stroke","#000"),a.setAttributeNS(null,"stroke-width",1),a.setAttributeNS(null,"fill","white"),r.appendChild(a);let i=document.createElementNS(n,"text");i.setAttributeNS(null,"x",90),i.setAttributeNS(null,"y",25),i.setAttributeNS(null,"text-anchor","middle"),i.setAttributeNS(null,"fill","black"),i.setAttributeNS(null,"font-weight","bold"),i.textContent=e.Name,r.appendChild(i);let o=60;e.Properties.forEach((e=>{let t=document.createElementNS(n,"text");t.setAttributeNS(null,"x",7),t.setAttributeNS(null,"y",o),t.setAttributeNS(null,"fill","black"),t.textContent=`${AccessModifierToChar(e.AccessModifier)} ${e.Name}: ${e.Type}`,r.appendChild(t),o+=20})),o-=10;let l=document.createElementNS(n,"line");l.setAttributeNS(null,"x1",0),l.setAttributeNS(null,"y1",o),l.setAttributeNS(null,"x2",t),l.setAttributeNS(null,"y2",o),l.setAttributeNS(null,"stroke","#000"),l.setAttributeNS(null,"stroke-width",1),r.appendChild(l),o+=20,e.Methods.forEach((e=>{let t=document.createElementNS(n,"text");t.setAttributeNS(null,"x",7),t.setAttributeNS(null,"y",o),t.setAttributeNS(null,"fill","black");let a="",i=!0;e.Arguments.forEach((e=>{i||(a+=", "),i=!1,a+=`${e.Name}: ${e.Type}`})),t.textContent=`${AccessModifierToChar(e.AccessModifier)} ${e.Name}(${a}): ${e.ReturnType}`,r.appendChild(t),o+=20})),o-=50;let s=document.createElementNS(n,"rect");if(s.setAttributeNS(null,"x",0),s.setAttributeNS(null,"y",40),s.setAttributeNS(null,"width",t),s.setAttributeNS(null,"height",o),s.setAttributeNS(null,"stroke","#000"),s.setAttributeNS(null,"stroke-width",1),s.setAttributeNS(null,"fill","none"),r.appendChild(s),e.TemplateArguments.length>0){const a=100,i=20*e.TemplateArguments.length+4,l=t-a/2,s=-i/2;let c=document.createElementNS(n,"rect");c.setAttributeNS(null,"x",l),c.setAttributeNS(null,"y",s),c.setAttributeNS(null,"width",a),c.setAttributeNS(null,"height",i),c.setAttributeNS(null,"stroke","#000"),c.setAttributeNS(null,"stroke-width",1),c.setAttributeNS(null,"fill","white"),c.setAttributeNS(null,"stroke-dasharray",dottedLine),r.appendChild(c),o=4,e.TemplateArguments.forEach((e=>{let t=document.createElementNS(n,"text");t.setAttributeNS(null,"x",l+7),t.setAttributeNS(null,"y",o),t.setAttributeNS(null,"fill","black"),t.textContent=`${e.Name}: ${e.Type}`,r.appendChild(t),o+=20}))}return r}function GenerateCommentDiagram(e){const t=e.RowCount,n=20,r=14*t+n+18,a="http://www.w3.org/2000/svg",i=document.createElementNS(a,"g");i.setAttributeNS(null,"class","draggable diagram"),i.style.transform=`translate(${e.Position.X}px, ${e.Position.Y}px)`;let o=document.createElementNS(a,"polygon");o.setAttributeNS(null,"class","draggable-header"),o.setAttributeNS(null,"points",`0,0 180,0 200,20 200,${r} 0,${r}`),o.setAttributeNS(null,"stroke","#000"),o.setAttributeNS(null,"stroke-width",1),o.setAttributeNS(null,"fill","white"),i.appendChild(o);let l=document.createElementNS(a,"polygon");return l.setAttributeNS(null,"points","180,0 200,20 180,20"),l.setAttributeNS(null,"stroke","#000"),l.setAttributeNS(null,"stroke-width",1),l.setAttributeNS(null,"fill","none"),i.appendChild(l),i.appendChild(MakeMultiLineText(t,190,e.Content,8,32)),i}const dottedLine="5,5",dashedLine="10,10",dashDottedLine="20,10,5,10",dashedLineWithTwoDots="20,10,5,5,5,10";function GetConnectorStyle(e){switch(e){case"Association":default:return{MarkerEnd:"arrow-end"};case"Dependence":return{Dashes:dashedLine,MarkerEnd:"arrow-end"};case"Aggregation":return{MarkerStart:"elongated-romb-nofill-start"};case"Composition":return{MarkerStart:"elongated-romb-start"};case"Implementation":return{Dashes:dashedLine,MarkerEnd:"triangle-nofill-end"};case"Generalization":case"Inheritance":return{MarkerEnd:"triangle-nofill-end"}}}function ClearConnectorsSvgContainer(){for(;connectorsSvgContainer.firstChild;)connectorsSvgContainer.removeChild(connectorsSvgContainer.lastChild)}function AddConnector(e,t,n){const r=GetConnectorStyle(n);let a=document.createElementNS("http://www.w3.org/2000/svg","line");a.setAttributeNS(null,"x1",e.x),a.setAttributeNS(null,"y1",e.y),a.setAttributeNS(null,"x2",t.x),a.setAttributeNS(null,"y2",t.y),a.setAttributeNS(null,"stroke","#000"),a.setAttributeNS(null,"stroke-width",2),void 0!==r.Dashes&&a.setAttributeNS(null,"stroke-dasharray",r.Dashes),void 0!==r.MarkerStart&&a.setAttributeNS(null,"marker-start",`url(#${r.MarkerStart})`),void 0!==r.MarkerEnd&&a.setAttributeNS(null,"marker-end",`url(#${r.MarkerEnd})`),connectorsSvgContainer.appendChild(a)}function FindIntersectionPoint(e,t,n){let r={x1:e.x,y1:e.y,x2:t.x,y2:t.y};for(let e=0;e<n.length;e++){let t=n[e],a=n[(e+1)%n.length],i=GetIntersection(r,{x1:t.x,y1:t.y,x2:a.x,y2:a.y});if(i.onSegment1&&i.onSegment2)return{x:i.x,y:i.y}}return null}function GetIntersection(e,t){let n=(t.y2-t.y1)*(e.x2-e.x1)-(t.x2-t.x1)*(e.y2-e.y1),r=((t.x2-t.x1)*(e.y1-t.y1)-(t.y2-t.y1)*(e.x1-t.x1))/n,a=((e.x2-e.x1)*(e.y1-t.y1)-(e.y2-e.y1)*(e.x1-t.x1))/n,i=r>=0&&r<=1,o=a>=0&&a<=1;return{x:e.x1+r*(e.x2-e.x1),y:e.y1+r*(e.y2-e.y1),onSegment1:i,onSegment2:o}}function ClientRectToArrRect(e,t){return[e,{x:e.x+t.width,y:e.y},{x:e.x+t.width,y:e.y+t.height},{x:e.x,y:e.y+t.height}]}function PosToRectCenter(e,t){return{x:e.x+t.width/2,y:e.y+t.height/2}}function CreateDiagramConnector(e,t,n){let r=GetTranslateXY(e.Element),a=ClientRectToArrRect(r,e.Element.getBoundingClientRect()),i=PosToRectCenter(r,e.Element.getElementsByClassName("draggable-header")[0].getBoundingClientRect()),o=GetTranslateXY(t.Element),l=ClientRectToArrRect(o,t.Element.getBoundingClientRect()),s=PosToRectCenter(o,t.Element.getElementsByClassName("draggable-header")[0].getBoundingClientRect()),c=FindIntersectionPoint(i,s,a),u=FindIntersectionPoint(i,s,l);null!==c&&null!==u&&AddConnector(getPosOnGrid(c),getPosOnGrid(u),n)}function GenerateDiagramsConnectors(){ClearConnectorsSvgContainer(),workspaceDocument.Connectors.forEach((e=>{let t=workspaceDocument.Diagrams.find((t=>t.Name===e.From)),n=workspaceDocument.Diagrams.find((t=>t.Name===e.To));void 0!==t&&void 0!==n&&CreateDiagramConnector(t,n,e.Type)}))}function RegenerateDiagramConnectors(e){GenerateDiagramsConnectors()}function RegenerateCurrentDiagramConnectors(){RegenerateDiagramConnectors(currentSelectedDiagramIndex)}function GenerateInputHints(e){return"Type"==e||"ReturnType"==e?["string","object","int","float","double","Array","List","Map","Dictionary","Set"]:"AccessModifier"==e?["Public","Private","Protected"]:null}function GetRelationInputHints(e){return"Type"==e?["Association","Dependence","Aggregation","Composition","Implementation","Generalization"]:"From"==e||"To"==e?workspaceDocument.Diagrams.map((e=>e.Name)):null}function GenerateHints(e,t){const n=document.createElement("datalist");return n.id=t,e.forEach((e=>{if(void 0!==e){const t=document.createElement("option");t.value=e,n.appendChild(t)}})),n}let uniqueInputFieldId=0;function GenerateTextField(e,t,n,r=(()=>{RegenerateCurrentDiagram(),UpateJsonDocumentViewer()})){const a=document.createElement("div");a.classList.add("col-md","mt-1");const i=document.createElement("div");i.classList.add("form-floating");const o=++uniqueInputFieldId,l=`input-u${o}`,s=document.createElement("input");s.classList.add("form-control"),s.id=l,s.value=t.toString(),s.oninput=function(){n[e]=s.value,r()},isGuest&&s.setAttribute("readonly",!0),i.appendChild(s);const c=GenerateInputHints(e);if(null!==c){const e=`hint-u${o}`;i.appendChild(GenerateHints(c,e)),s.setAttribute("list",e)}const u=document.createElement("label");return u.htmlFor=l,u.innerText=e,i.appendChild(u),a.appendChild(i),a}function GenerateListHeader(e,t,n,r,a=UpdateCurrentDiagram){const i=document.createElement("ul");i.classList.add("list-group","mt-2");const o=document.createElement("li");o.classList.add("list-group-item","d-flex","flex-row");const l=document.createElement("p");if(l.classList.add("mb-0"),l.innerText=e,o.appendChild(l),r){const r=document.createElement("button");r.classList.add("btn","p-0","ms-auto"),r.onclick=function(){let r=n(e);void 0!==r&&(t.push(r),a(r))};const i=document.createElement("i");i.classList.add("bi","bi-plus-circle","fs-5"),r.appendChild(i),o.appendChild(r)}return i.appendChild(o),i}function GenerateListItem(e,t,n,r,a=UpdateCurrentDiagram){const i=document.createElement("li");if(i.classList.add("list-group-item","d-flex","flex-row"),i.appendChild(e),r){const e=document.createElement("button");e.classList.add("btn","p-0","border-0","mt-2","align-self-start"),e.onclick=function(){t.splice(n,1),a(n)};const r=document.createElement("i");r.classList.add("bi","bi-x","fs-5"),e.appendChild(r),i.appendChild(e)}return i}function GenerateListItems(e,t,n){let r=void 0!==n(e),a=GenerateListHeader(e,t,n,r);for(var i=0;i<t.length;i++)a.appendChild(GenerateListItem(GenerateInputField(i,t[i],t,n),t,i,r));return a}function GenerateGroup(e,t,n){const r=document.createElement("ul");r.classList.add("list-group","mt-2");const a=document.createElement("li");return a.classList.add("list-group-item"),a.innerText=e,r.appendChild(a),Object.getOwnPropertyNames(t).forEach((e=>{const a=document.createElement("li");a.classList.add("list-group-item"),a.appendChild(GenerateInputField(e,t[e],t,n)),r.appendChild(a)})),r}function GenerateInputField(e,t,n,r){return"string"==typeof t||"number"==typeof t?GenerateTextField(e,t,n):Array.isArray(t)?GenerateListItems(e,t,r):"object"==typeof t?GenerateGroup(e,t,r):document.createElement("div")}let parametersPanel=document.getElementById("diagram-parameters");function GenerateParametersPanel(e){let t=[];if(void 0!==e){let n=Object.getOwnPropertyNames(e);if(n.includes("Type")){let r=GetGeneratePropertyFunc(e.Type);n.forEach((n=>{if("Type"===n)return;let a=IgnoreWorkspacePrivateFields(n,e[n]);void 0!==a&&t.push(GenerateInputField(n,a,e,r))}))}}for(;parametersPanel.firstChild;)parametersPanel.removeChild(parametersPanel.lastChild);t.forEach((e=>parametersPanel.appendChild(e)))}function GenerateRelationshipTextField(e,t,n,r=(()=>{RegenerateCurrentDiagram(),UpateJsonDocumentViewer()})){const a=document.createElement("div");a.classList.add("col-md","mt-1");const i=document.createElement("div");i.classList.add("form-floating");const o=++uniqueInputFieldId,l=`input-u${o}`,s=document.createElement("input");s.classList.add("form-control"),s.id=l,s.value=t.toString(),s.oninput=function(){n[e]=s.value,r()},isGuest&&s.setAttribute("readonly",!0),i.appendChild(s);const c=GetRelationInputHints(e);if(null!==c){const e=`hint-u${o}`;i.appendChild(GenerateHints(c,e)),s.setAttribute("list",e)}const u=document.createElement("label");return u.htmlFor=l,u.innerText=e,i.appendChild(u),a.appendChild(i),a}function GenerateRelationshipListItem(e,t){const n=document.createElement("ul");n.classList.add("list-group","mt-2");const r=document.createElement("li");return r.classList.add("list-group-item"),r.innerText=e,n.appendChild(r),Object.getOwnPropertyNames(t).forEach((e=>{const r=document.createElement("li");r.classList.add("list-group-item"),r.appendChild(GenerateRelationshipTextField(e,t[e],t,(()=>{RegenerateCurrentDiagramConnectors()}))),n.appendChild(r)})),n}function GenerateRelationshipPanelListItems(e){let t=workspaceDocument.Connectors;let n=GenerateListHeader("Relationship",t,(()=>({Type:"Aggregation",From:e.Name,To:"None"})),!0,(e=>{UpdateCurrentDiagram()}));for(var r=0;r<t.length;r++)e.Name!==t[r].From&&e.Name!==t[r].To||n.appendChild(GenerateListItem(GenerateRelationshipListItem(r,t[r]),t,r,!0));return n}let relationshipPanel=document.getElementById("diagram-relationship");function GenerateRelationshipPanel(e){let t=[];for(void 0!==e&&t.push(GenerateRelationshipPanelListItems(e));relationshipPanel.firstChild;)relationshipPanel.removeChild(relationshipPanel.lastChild);t.forEach((e=>relationshipPanel.appendChild(e)))}function GenerateDetailsPanel(e){GenerateRelationshipPanel(e),GenerateParametersPanel(e)}let currentSelectedDiagramIndex=-1;function GenerateDetailsPanelById(e){-1===GenerateDetailsPanelById&&GenerateDetailsPanel(Object()),e!==currentSelectedDiagramIndex&&(currentSelectedDiagramIndex=e,GenerateDetailsPanel(GetDiagramById(e)))}function GenerateDetailsPanelByElement(e){GenerateDetailsPanelById(GetDiagramIdByElement(e))}function RegenerateDetailsPanel(){GenerateDetailsPanel(GetDiagramById(currentSelectedDiagramIndex))}document.getElementById("remove-diagram-btn").onclick=()=>{RemoveSelectedDiagram()};let jsonDocumentViewer=document.getElementById("json-document-viewer");function UpateJsonDocumentViewer(){jsonDocumentViewer.value=JSON.stringify(workspaceDocument,IgnoreWorkspacePrivateFields,4)}function GetAllInputFieldsAsJson(){let e="{",t=document.querySelectorAll('div[id^="settings-"]');for(let n=0;n<t.length;n++){let r=t[n].querySelectorAll('*[id^="input-"]');for(let t=0;t<r.length;t++){let n,a=r[t].id.substring(6);"checkbox"===r[t].type?n=r[t].checked:"text"===r[t].type?n=`"${r[t].value}"`:"select-one"===r[t].type&&(n=r[t].selectedIndex),e+=`"${a}":${n}`,t<r.length-1&&(e+=",")}n<t.length-1&&(e+=",")}return e+="}",e}function SetAllInputFieldsFromJson(e){let t=JSON.parse(e),n=document.querySelectorAll('div[id^="settings-"]');for(let e=0;e<n.length;e++){let r=n[e].querySelectorAll('*[id^="input-"]');for(let e=0;e<r.length;e++){let n=t[r[e].id.substring(6)];"checkbox"===r[e].type?r[e].checked=n:"text"===r[e].type?r[e].value=n:"select-one"===r[e].type&&(r[e].selectedIndex=n)}}}isGuest&&jsonDocumentViewer.setAttribute("readonly",!0),jsonDocumentViewer.oninput=()=>{try{workspaceDocument=JSON.parse(jsonDocumentViewer.value),RegenerateDiagrams(),GenerateDiagramsConnectors()}catch(e){}};let diagramsSvgContainer,connectorsSvgContainer,workspaceDocument={Diagrams:[],Connectors:[]};function SetDefaultWorkspace(){workspaceDocument={Diagrams:[{Type:"ClassDiagram",Name:"Class_1",Properties:[{Name:"Prop 1",Type:"int",AccessModifier:"Public"},{Name:"Prop 2",Type:"string",AccessModifier:"Public"}],Methods:[{AccessModifier:"Public",ReturnType:"string",Name:"Method 1",Arguments:[]}],Attributes:["Attribute 1","Attribute 2"],TemplateArguments:[],Position:{X:"820",Y:"750"},Element:null},{Type:"ClassDiagram",Name:"Class_2",Properties:[{Name:"Prop 3",Type:"string",AccessModifier:"Public"},{Name:"Prop 4",Type:"float",AccessModifier:"Public"}],Methods:[{AccessModifier:"Public",ReturnType:"string",Name:"Method 2",Arguments:[{Type:"string",Name:"name"}]}],Attributes:[],TemplateArguments:[],Position:{X:"1030",Y:"1020"},Element:null}],Connectors:[{Type:"Aggregation",From:"Class_1",To:"Class_2"}]},RegenerateDiagrams()}function AddDiagram(e){workspaceDocument.Diagrams.push(e),UpdateAllDiagrams()}function RemoveDiagramByIndex(e){workspaceDocument.Diagrams.splice(e,1),UpdateAllDiagrams()}function RemoveSelectedDiagram(){if(-1!==currentSelectedDiagramIndex){const e=currentSelectedDiagramIndex;currentSelectedDiagramIndex=-1,RemoveDiagramByIndex(e)}}function CreateWorkspaceSvgContainer(){const e="http://www.w3.org/2000/svg";let t=document.createElementNS(e,"svg");t.setAttributeNS(null,"width","100%"),t.setAttributeNS(null,"height","100%"),t.classList.add("svg-container"),diagramsSvgContainer=document.createElementNS(e,"g"),diagramsSvgContainer.setAttributeNS(null,"width","100%"),diagramsSvgContainer.setAttributeNS(null,"height","100%"),t.appendChild(diagramsSvgContainer),connectorsSvgContainer=document.createElementNS(e,"g"),connectorsSvgContainer.setAttributeNS(null,"width","100%"),connectorsSvgContainer.setAttributeNS(null,"height","100%"),t.appendChild(connectorsSvgContainer),workspace.appendChild(t)}function UpdateAllDiagrams(){RegenerateDetailsPanel(),RegenerateDiagrams(),GenerateDiagramsConnectors(),UpateJsonDocumentViewer()}function UpdateCurrentDiagram(){RegenerateDetailsPanel(),RegenerateDiagram(currentSelectedDiagramIndex),RegenerateDiagramConnectors(currentSelectedDiagramIndex),UpateJsonDocumentViewer()}CreateWorkspaceSvgContainer();var connection=(new signalR.HubConnectionBuilder).withUrl("/api/workspace").build();function SinkWorkspace(){connection.invoke("Sink",GetAllInputFieldsAsJson(),JSON.stringify(workspaceDocument,IgnoreWorkspacePrivateFields)).then((function(){console.log("sink")})).catch((function(e){return console.error(e.toString())}))}function PullWorkspace(){connection.invoke("Pull").then((function(){console.log("pull")})).catch((function(e){return console.error(e.toString())}))}function JoinToWorkspace(e){connection.invoke("Join",e).then((function(){console.log("join: "+e),PullWorkspace(),GetWorkspaceUsers(),InitChat()})).catch((function(e){return console.error(e.toString())}))}function LeaveFromWorkspace(){connection.invoke("Leave").then((function(){console.log("leave")})).catch((function(e){return console.error(e.toString())}))}function GetWorkspaceUsers(){connection.invoke("UserList").then((function(){console.log("UserList")})).catch((function(e){return console.error(e.toString())}))}function AddMessageToChat(e,t,n){let r=document.getElementById("chat-messages");const a=username===e,i=document.createElement("p");i.classList.add("small","mb-1"),i.innerText=username;const o=document.createElement("p");o.classList.add("small","mb-1","text-muted"),o.innerText=t;const l=document.createElement("div");l.classList.add("d-flex","justify-content-between"),a?(l.appendChild(i),l.appendChild(o)):(l.appendChild(o),l.appendChild(i));const s=document.createElement("div");s.classList.add("d-flex","flex-row"),a?s.classList.add("justify-content-start"):s.classList.add("justify-content-end","mb-4","pt-1");const c=document.createElement("div");c.classList.add("d-flex","flex-row");const u=document.createElement("p");u.classList.add("small","p-2","rounded-3"),a?(u.classList.add("ms-3","mb-3"),u.style.background="#f5f6f7"):u.classList.add("me-3","mb-3","text-white","bg-warning"),u.innerText=n,c.appendChild(u);const d=document.createElement("i");d.classList.add("bi","bi-person","fs-1"),a?(s.appendChild(d),s.appendChild(c)):(s.appendChild(c),s.appendChild(d)),r.appendChild(l),r.appendChild(s)}function SendMessage(e){AddMessageToChat(username,"Now",e),connection.invoke("SendMessage",e).then((function(){console.log("SendMessage")})).catch((function(e){return console.error(e.toString())}))}function GetAllMessages(){connection.invoke("GetAllMessages").then((function(){console.log("GetAllMessages")})).catch((function(e){return console.error(e.toString())}))}function InitChat(){if(isGuest)return;const e=document.getElementById("chat-messages"),t=document.getElementById("button-send-msg"),n=document.getElementById("input-send-msg");e.innerHTML="",t.onclick=()=>{let e=n.value;""!==e&&(console.log("msg-> "+e),SendMessage(e))},GetAllMessages()}connection.on("Update",(function(e,t){console.log("update:"+e),SetAllInputFieldsFromJson(e),workspaceDocument=JSON.parse(t),UpdateAllDiagrams()})),connection.start().then((function(){console.log("start"),console.log("Auto connect to id: "+autoConnectWorkspaceId),void 0!==typeof autoConnectWorkspaceId&&JoinToWorkspace(autoConnectWorkspaceId.toString())})).catch((function(e){return console.error(e.toString())})),isGuest||(window.onbeforeunload=function(e){e.preventDefault(),e.returnValue=""}),document.onkeydown=e=>{if("Delete"===e.code)RemoveSelectedDiagram();else{let t=!1;switch(e.code){case"ArrowUp":GetDiagramById(currentSelectedDiagramIndex).Position.Y-=gridSnap,t=!0;break;case"ArrowDown":GetDiagramById(currentSelectedDiagramIndex).Position.Y+=gridSnap,t=!0;break;case"ArrowLeft":GetDiagramById(currentSelectedDiagramIndex).Position.X-=gridSnap,t=!0;break;case"ArrowRight":GetDiagramById(currentSelectedDiagramIndex).Position.X+=gridSnap,t=!0}t&&(UpdateCurrentDiagram(),e.preventDefault())}},connection.on("ReceiveMessage",(function(e,t,n){console.log("msg:"+e+", "+t+", "+n),AddMessageToChat(e,t,n)}));